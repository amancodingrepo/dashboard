generator client {
  provider = "prisma-client-js"
  output   = "../apps/api/node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Document {
  id                 Int        @id @default(autoincrement())
  documentId         String?    @unique
  name               String
  filePath           String?
  fileType           String?
  fileSize           Float?
  status             String?
  isValidatedByHuman Boolean    @default(false)
  organizationId     String?
  departmentId       String?
  uploadedAt         DateTime?
  uploadedBy         String?
  templateName       String?
  validatedAt        DateTime?
  validatedBy        String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  analyticsId        String?
  confidenceScore    Float?
  processingTime     Float?
  invoiceId          Int?
  analytics          Analytics? @relation(fields: [analyticsId], references: [id])
  invoice            Invoice?   @relation(fields: [invoiceId], references: [id])
  lineItems          LineItem[]
}

model Invoice {
  id                   Int        @id @default(autoincrement())
  invoiceRef           String?
  invoiceDate          DateTime?
  deliveryDate         DateTime?
  subTotal             Float?
  totalTax             Float?
  totalAmount          Float?
  currency             String?
  vendorId             Int?
  customerId           Int?
  paymentTerms         String?
  paymentDueDate       DateTime?
  paymentStatus        String?    @default("pending")
  extractionConfidence Float?
  createdAt            DateTime   @default(now())
  updatedAt            DateTime   @updatedAt
  documents            Document[]
  customer             Customer?  @relation(fields: [customerId], references: [id])
  vendor               Vendor?    @relation(fields: [vendorId], references: [id])
}

model LineItem {
  id                   Int       @id @default(autoincrement())
  srNo                 Int?
  description          String?
  quantity             Float?
  unitPrice            Float?
  totalPrice           Float?
  sachkonto            String?
  buSchluessel         String?
  vatRate              Float?
  vatAmount            Float?
  extractionConfidence Float?
  documentId           Int?
  document             Document? @relation(fields: [documentId], references: [id])
}

model Vendor {
  id        Int       @id @default(autoincrement())
  name      String
  address   String?
  taxId     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  invoices  Invoice[]
}

model Customer {
  id       Int       @id @default(autoincrement())
  name     String
  address  String?
  invoices Invoice[]
}

model Analytics {
  id             String     @id @default(uuid())
  documentCount  Int        @default(0)
  processedCount Int        @default(0)
  validatedCount Int        @default(0)
  avgConfidence  Float?
  totalFileSize  Float?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  documents      Document[]
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  name         String
  role         String        @default("user") // admin, manager, user, viewer
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  chatHistory  ChatHistory[]
}

model ChatHistory {
  id        Int      @id @default(autoincrement())
  userId    Int?
  query     String
  sql       String?
  results   Json?
  error     String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([createdAt])
}
